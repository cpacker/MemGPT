services:
  memgpt_server:
    image: memgpt_server
    hostname: memgpt-server
    build:
      context: .
      dockerfile: Dockerfile
      target: development
      args:
        - MEMGPT_ENVIRONMENT=DEVELOPMENT
    depends_on:
      - memgpt_db
    env_file:
      - .env
    # no value syntax to not set the env at all if it is not set in .env
    environment:
      - MEMGPT_SERVER_PASS=test_server_token
      - MEMGPT_POSTGRES_URI
      - MEMGPT_SERVER_PASS
      - MEMGPT_PG_DB
      - MEMGPT_PG_USER
      - MEMGPT_PG_PASSWORD
      - MEMGPT_PG_HOST
      - MEMGPT_PG_PORT
      - OPENAI_API_KEY
    volumes:
      - ./memgpt:/memgpt
      - ~/.memgpt/credentials:/root/.memgpt/credentials
      - ./configs/server_config.yaml:/root/.memgpt/config
      - ./CONTRIBUTING.md:/CONTRIBUTING.md
      - ./tests/pytest_cache:/memgpt/.pytest_cache
      - ./tests/pytest.ini:/memgpt/pytest.ini
      - ./pyproject.toml:/pyproject.toml
      - ./tests:/tests
    ports:
      - "8083:8083"
      - "8283:8283"
